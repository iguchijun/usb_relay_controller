プロジェクト名
生成AIによる機械コーディングの試み

バージョン:V01.01

作成日:2025/4/20

作成者:下北沢研究所

システム概要
環境：Windows、Python、Tkinter、pywinusb.hid、USBリレーボード（８ｃｈ）を使用する。
ＰＣのＵＳＢに接続したリレーボードのコントロールアプリ。
1～8個のリレーを持つリレーボードをアプリ画面からコントロールする。
それぞれのリレーを即時にＯＮまたはＯＦＦできること。
それぞれのリレーに24時間タイマーの設定を可能とすること。タイマー
設定されたリレーが開始設定した時分にＯＮになり、終了設定した時分
にＯＦＦになること。
それぞれのリレーに名称を設定できること。
画面から設定した内容を外部ファイルに保存できること。
保存した外部ファイルを読み込んで画面に表示できること。
デフォルトファイルを設定した場合、プログラム立ち上げ時自動的に読み込み画面設定すること。
設定画面からリレーボードのベンダーID、デバイスID、リレー個数、の設定を受け付け変更できること。
USBリレーの接続が正常にできなかった場合でも、プログラム機能を動かして見せること。

機能仕様
１．入出力ファイル
(1)設定ファイル
　①USBリレーボードのベンダーID　16進数または１０進数
　②USBリレーボードのデバイスID　16進数または１０進数
　③USBリレーボードのリレー個数　１～８までの１０進数
　④デフォルトファイル名　テキスト
(2)データファイル
　・リレーの個数分、以下の各項目を保持
　　①リレーの名称　テキスト３０桁
　　②タイマーSET　チェックボックス　ブーリアン
　　③タイマー開始時　数値
　　④タイマー開始分　数値
　　⑤タイマー終了時　数値
　　⑥タイマー終了分　数値

２．ファイル入出力機能
(1)設定ファイル
　①メニューの設定のクリックで設定画面を表示し入力受付
　②設定画面の保存ボタンクリックで外部に保存
　③立ち上げ時、設定ファイルを自動読み込みする
　④設定画面が開かれたときファイル内容を設定画面に表示
(2)データファイル
　①メニューのファイルのクリックで保存を選択した場合、
　Windowsのファイル出力画面を表示し、任意のファイル名
　で画面内容を外部に保存する。
　②メニューのファイルのクリックで入力を選択した場合、
　Windowsのファイル入力画面を表示し、任意のファイル
　の選択でファイルを入力し、画面に表示する。
　③設定画面のデフォルトファイル名のデータファイルが
　存在した場合、プログラム立ち上げ時、自動読み込みし、
　画面に表示する。

３．画面出力機能
(1)カレント日時分秒の表示
　①システム時刻を”2025/04/20 20:20:20"の形式で表示
(2)各リレー行はリレー個数分、動的に表示する。デフォルト８個
(3)リレーＯＮ/ＯＦＦインジケーター表示（テキスト）各リレーごと
　①各リレーがONの時、明るく輝いているように画面表示
　②各リレーがOFFの時、暗くOFFになっているように画面表示
　③各リレーのON/OFF状態はUSBリレーとの通信により機械
　的に取得して判定する
(4)タイマーステータス表示（テキスト表示）各リレーごと
　①タイマーが設定されていないときは”未設定”と表示
　②タイマーが設定されておりリレーがONでない場合”待機中”
　③タイマーが設定されておりリレーがONの場合”開始”
　④文字色は”未設定”グリーン、”待機中”ブラウン、”開始”赤
(5)メッセージ表示
　最下行に”ベンダーID：”ベンダーID　”デバイスID：”デバイスID
　プログラムメッセージをテキストで表示する。
　正常にデバイスがオープンされた場合はプログラムメッセージ
　”デバイスが正常にオープンされました。"と表示
　ベンダーID、デバイスIDの入力がない場合は”入力無し”と表示
　ベンダーIDとデバイスIDは16進の場合はinteger変換して表示
　16進でない場合は10進としてinteger変換して表示する。
　変換できなかった場合は”入力不正”と表示する。
　エラーがある場合は文字色赤、ない場合はネイビーで表示
　
　４．画面入力機能
(1)メニューエリアに「ファイル」を表示
　①サブメニューに「開く」「保存」セパレーター「終了」を表示
　②「開く」選択でWindowsのファイル入力画面を表示
　③「保存」選択でWindowsのファイル出力画面を表示
　④「終了」選択でプログラム終了
(2)メニューエリアに「設定」を表示（「ファイル」の右となり）
　①設定クリック時、サブ画面の設定画面を表示
(3)即時スイッチ（ボタン）各リレーごと
　①ONの時クリックでOFFにする。（USB通信でOFF指示をする）
　②OFFの時クリックでONにする。（USB通信でON指示をする）
　③USB通信で指示を出した後、インジケーター表示を更新
(4)名称入力（テキスト）各リレーごと
　①テキストの入力を受け付ける。
(5)タイマーセット（チェックボックス）各リレーごと
　①タイマーセットがチェックされたとき
　　1)開始時分、終了時分のチェックを行う（エラー仕様参照）
　　設定時刻にエラーがある場合はエラーメッセージを出力
　　して、チェックを強制的にOFFにする。
　　2)エラーがない場合、そのリレーのタイマー開始時分と
　　　終了時分のスピンボックスの入力を不可にする
　　3)エラーがない場合、タイマー時刻監視機能を開始する
　　4)エラーがない場合、タイマーステータスを更新する
　②タイマーセットのチェックが外されたとき
　　1)開始時分、終了時分ののスピンボックスの入力を可にする
　　2)タイマー時刻監視機能は行わない
　　3)タイマーステータスを更新する
(6)タイマー開始時の入力
　①スピンボックスにより0～23の値を選択する
(7)タイマー開始分の入力
　①スピンボックスにより0～59の値を選択する
(8)タイマー終了時の入力
　①スピンボックスにより0～23の値を選択する
(9)タイマー終了分の入力
　①スピンボックスにより0～59の値を選択する
(10)全部ＯＮ(ボタン）
　①各リレー全部ONにする。（USB通信で全部ON指示をする）
(11)全部OFF(ボタン）
　①各リレー全部OFFにする。（USB通信で全部OFF指示をする）
(12)画面クリア(ボタン）
　①各リレー行の、名称をクリア
　②各リレー行の、タイマーセットをOFFにする。
　③各リレー行の、開始時、開始分、終了時、終了分を０クリア

５．待機処理機能
(1)タイマー時刻監視機能
　①各リレーのタイマーセットがONのリレーがある場合
　　タイマー時刻監視処理を60秒ごとに行う。
　②カレント時刻を取得する
　③カレント時刻の時・分がタイマー開始時・分と等しい場合
　　リレーが既にONになっていない場合ONにする。（USB通信）　
　④カレント時刻の時・分がタイマー終了時・分と等しい場合
　　リレーが既にOFFになっていない場合OFFにする。（USB通信）　
　⑤リレーインジケータを更新する。（USB通信）
　⑥タイマーステータスを更新する。
(2)カレント日時分秒の更新を1秒ごとに繰り返す
　①カレント時刻を取得する。
　②カレント日時分秒欄の表示を更新する。

６．内部制御事項
(1)タイマーセットがONで”待機中”のリレーの即時スイッチがONになった場合または全部ONでONになった場合、
　　リレーステータス表示は”開始”にして、終了時分が来たらOFFにする。
(2)タイマーセットがONで”開始”のリレーの即時スイッチをOFFにした場合または全部OFFでOFFになった場合、
　　リレーステータス表示は”待機中”にして、開始時分が来たらONにする。
(3)既にONであるリレーのタイマーセットをOFFからONにした場合、
　　リレーステータス表示は”開始”にして、タイマー終了時分が来たらOFFにする。
(4)既にONであるリレーのタイマーセットをONからOFFにした場合、リレーステータス表示は”未設定”にする。
　　（リレーは手動に切り替わったので、ONのままになる）
(5)リレーが正常にオープンされなかった場合は、プログラムはリレーのコントロールが不可能であるが、プログラムは異常終了させないこと。
(6)リレーが正常にオープンされた場合は、開始時にデバイスとの通信から各リレーのON/OFF状況を取得し、ON/OFFインジケーターに反映させること。
(7)このコントロールプログラムが立ち上がり、リレーボードが制御下に入る以前にリレーボードのリレーが機械的にONになっている場合はONにするイベントがあったとみなす。
(8)デフォルトファイルを自動読み込みした場合、タイマーセットがONとなっている場合は、タイマーセットをONにするイベントがあったとみなす。

７．エラー処理
いかなるエラーが起きてもプログラムの即時終了はしないこと。
(1)設定ファイルのエラー
　①設定ファイルが読み込めない場合
　　プログラムメッセージに”デバイスが不明のためコントロール不可”
　②設定されたベンダーID、デバイスIDでオープンできなかった場合
　　プログラムメッセージに”デバイスが不明のためコントロール不可”
　③リレー個数は読み込めなかった場合、または読み込み内容が不正
　　であった場合、8とみなし設定してプログラムを続行する。
(2)データファイルのエラー
　①デフォルトファイル名の設定がありながら、そのファイルが
　　読み込めなかった場合。PRINT分でその旨を出力し、続行。
(3)ベンダーID、デバイスＩＤの設定によりＵＳＢ通信で
　HIDデバイスをフィルターが正常に取得できなかった場合
　またはデバイスのオープンが正常にできなかった場合
　プログラムメッセージに”デバイスをＯＰＥＮできないため
　コントロール不可”と表示する。プログラムは続行。
(4)タイマーセットがＯＮになったときの時刻チェック
　①開始時と分、終了時と分が全部０の場合
　　ポップアップで”タイマー時刻が設定されていません。”
　　と表示し、タイマーセットを強制的にOFFにする。
　②開始時分と終了時分が等しい場合
　　ポップアップで”タイマー開始と終了に同じ時刻は設定できません。”
　　と表示し、タイマーセットを強制的にOFFにする。
　③開始時分と終了時分はスピンボックスからの入力なので、
　原則時間としてあり得ない値の入力はないはずだが、
　開始時分と終了時分の内容が時間としてあり得ない値の場合
　ポップアップで”タイマー時刻にあり得ない数値が設定されて
　います。”と表示し、タイマーセットを強制的にOFFにする。

８．画面仕様
(1)メイン画面イメージ図
   A B C D E F G H I J K L M N O P Q R S T U V W X Y Z AAABACADAEAFAGAHAIAJAK
　|--------------------------------------------------------------------------|
1 |　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　－□×|
2 |ファイル　設定　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　|
3 |　　　　　　８ＣＨ　ＲＥＬＡＹ　ＣＯＮＴＲＯＬＬＥＲ　2025/04/20 20:20:20 |
4 |リレー即時　　名　　称   　　　　タイマー　開始時：開始分～終了時：終了分 |
5 |1:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
6 |2:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
7 |3:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
8 |4:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
9 |5:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
10|6:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
11|7:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
12|8:〇[入切][名称入力欄　　　　　　]未設定□　[ 0  ]：[ 0  ]～[ 0  ]：[ 0  ]|
13|　[全部入][全部切][画面クリア]　　　　　　　　　　　　　　　　　　　　　　|
14|　ベンダーID：5824　デバイスID：1503　デバイスは正常にオープンしました。　|
15|　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　|
  |--------------------------------------------------------------------------|
  
(2)メイン画面の説明
　行カラム
  2:メニュー欄
  　”ファイル”クリックで”開く””保存”セパレーター”終了”を表示
  　”設定”クリックで”設定画面”を表示
  3G：チャンネル数は設定画面からのリレー個数で可変、デフォルトは８
  3AB:カレント年月日時分秒を表示
  4:行のラベル表示
  5:から12:の行数は設定画面からのリレー個数で可変、デフォルトは８段
  5A:リレー番号のラベル
  5B:リレーのON/OFFインジケーター（ONの時光っているかのように見せること。）
  5C:ボタン、”入切”と表示（押される度に各リレーをＯＮだったらＯＦＦ、ＯＦＦだったらＯＮにする）
  5E:各リレーに名称を付けて入力できるテキスト入力ボックス。
  5R:タイマーステータス表示（リレーのタイマーが設定されていないときは”未設定”と表示
     タイマーセットがSETになったら”待機中”と表示、タイマーが開始したら”開始”と表示
     文字色は”未設定”は緑、”待機中”はオレンジ、”開始”は赤とする。
  5U:チェックボックス、チェックでタイマーSETにする。
  5W:スピンボックス、開始時（0～23　デフォルト 0）
  5AA:スピンボックス、開始分（0～59　デフォルト 0）
  5AE:スピンボックス、終了時（0～23　デフォルト 0）
  5AI:スピンボックス、終了分（0～59　デフォルト 0）
  13B:ボタン、”全部入”（リレー1～全部ＯＮにする。既にＯＮのものはＯＮのまま）
  13F:ボタン、”全部切”（リレー1～全部OFFにする。既にOFFのものはOFFのまま）
  13J:ボタン、”画面クリア”（各リレーの名称、リレータイマーセット、開始時、開始分、終了時、終了分をクリア）
      名称は空白、リレータイマーセットはＯＦＦ(False)、リレーステータス表示は”未設定”、時刻は全部0にする。
  14:メッセージ出力欄（リレーが正常にオープンされている場合は文字色navy、エラーがある場合はred。）
     ”ベンダーID：”ベンダーID　”デバイスID：”デバイスID　プログラムメッセージ
     (プログラムメッセージは内部で設定された最後のエラーメッセージ、正常の場合は”正常の場合はデバイスは正常にオープンしました。”
     
(3)サブ画面イメージ図
   A B C D E F G H I J K L M N 
　|----------------------------|
1 |　設定画面　　　　　　－□×|
2 |　　　　　　　　　　　　　　|
3 |　ベンダーID　[　　　　　　]|
4 |　デバイスID　[　　　　　　]|
5 |　リレー個数　[　　　　　　]|
6 |　ﾃﾞﾌｫﾙﾄﾌｧｲﾙ名[　　　　　　]|
7 |　　　　　　　　　　　　　　|
8 |　　　　　　[保存]　　　　　|
9 |　　　　　　　　　　　　　　|
　|----------------------------|

(4)サブ画面の説明
　行カラム
　3B:ラベル”ベンダーID”
　3H:ベンダーID入力テキストボックス
　4B:ラベル”デバイスID”
　4H:デバイスID入力テキストボックス
　5B:ラベル”リレー個数”
　5H:リレー個数入力テキストボックス
　6B:ラベル”ﾃﾞﾌｫﾙﾄﾌｧｲﾙ名”
　6H:デフォルトファイル名入力テキストボックス
　8G:ボタン”保存”（ボタン押下で設定ファイルを保存）
　　ボタン押下時、ポップアップで"変更内容を反映するためには、このプログラムの再起動が必要です。"と表示
